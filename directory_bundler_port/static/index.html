<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directory Bundler - Web Interface</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <h1>üì¶ Directory Bundler</h1>
                <p class="subtitle">Advanced Codebase Analysis Tool v4.5</p>
            </div>
            <div class="status-indicator" id="serverStatus">
                <span class="status-dot"></span>
                <span class="status-text">Connecting...</span>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Configuration Panel -->
            <section class="panel config-panel">
                <h2>üéØ Scan Configuration</h2>
                
                <div class="form-group">
                    <label for="targetPath">Target Directory Path</label>
                    <div class="input-group">
                        <input type="text" id="targetPath" placeholder="C:\path\to\your\project" 
                               value="." class="input-field">
                        <button class="btn btn-secondary" onclick="browseDirectory()">Browse</button>
                    </div>
                    <small class="help-text">Enter the full path to the directory you want to scan</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="scanMode">Analysis Mode</label>
                        <select id="scanMode" class="input-field">
                            <option value="quick">Quick Static Analysis</option>
                            <option value="full">Full Dynamic Analysis</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="maxFileSize">Max File Size (MB)</label>
                        <input type="number" id="maxFileSize" value="50" min="1" max="500" class="input-field">
                    </div>
                </div>

                <div class="form-row">
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeTests" checked>
                            <span>Include Test Files</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeDocs" checked>
                            <span>Include Documentation</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeConfig" checked>
                            <span>Include Config Files</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enableLMStudio">
                        <span>Enable AI Analysis (LM Studio)</span>
                    </label>
                    <small class="help-text">Requires LM Studio running on network</small>
                </div>

                <div id="aiPersonaSection" style="display: none;">
                    <div class="form-group">
                        <label for="lmstudioUrl">üåê LM Studio URL</label>
                        <input type="text" id="lmstudioUrl" class="input-field"
                               value="http://localhost:1234"
                               placeholder="http://192.168.0.190:1234">
                        <small class="help-text">IP:port of your LM Studio instance (endpoint auto-added)</small>
                    </div>
                    <div class="form-group">
                        <label for="aiPersona">ü§ñ AI Analysis Persona</label>
                        <select id="aiPersona" class="input-field">
                            <option value="default">Default (General Analysis)</option>
                            <option value="security_auditor">üîí Security Auditor (OWASP Top 10)</option>
                            <option value="code_tutor">üìö Code Tutor (Best Practices)</option>
                            <option value="documentation_expert">üìñ Documentation Expert (Docstrings)</option>
                            <option value="performance_analyst">‚ö° Performance Analyst (Optimization)</option>
                        </select>
                    </div>
                    <div class="checkbox-group" style="margin-top: 15px;">
                        <label class="checkbox-label">
                            <input type="checkbox" id="bypassCache">
                            <span>Force Fresh Scan (Bypass Cache)</span>
                        </label>
                        <small class="help-text" style="display: block; margin-left: 0;">Use for CI/CD - always runs fresh analysis</small>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary btn-large" onclick="startScan()">
                        <span class="btn-icon">üöÄ</span> Start Scan
                    </button>
                    <button class="btn btn-secondary" onclick="retryScan()" title="Re-run last scan">üîÑ Retry</button>
                    <button class="btn btn-secondary" onclick="clearForm()">Clear</button>
                </div>
            </section>

            <!-- LM Studio Model Manager -->
            <section class="panel model-panel">
                <div class="panel-header model-panel-header">
                    <div>
                        <h2>üß† LM Studio Model Manager</h2>
                        <p class="help-text">Check status, list available models, and load or unload them directly.</p>
                    </div>
                    <div class="model-controls">
                        <input type="text" id="lmBaseUrl" class="input-field" value="http://localhost:1234" placeholder="http://localhost:1234">
                        <button class="btn btn-secondary btn-small" onclick="refreshModels()">üîÑ Refresh</button>
                    </div>
                </div>
                <div id="lmStatus" class="model-status">Not checked yet.</div>
                <div id="modelsList" class="models-list empty-state">No models fetched yet.</div>
            </section>

            <!-- Progress Panel -->
            <section class="panel progress-panel" id="progressPanel" style="display: none;">
                <h2>‚öôÔ∏è Scan Progress</h2>
                <div class="progress-info">
                    <div class="progress-status" id="progressStatus">Initializing...</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-details" id="progressDetails"></div>
                    <div id="scanErrorMessage" style="color: #ef4444; margin-top: 15px; display: none;"></div>
                    <div id="retryButton" style="margin-top: 15px; display: none;">
                        <button class="btn btn-primary" onclick="retryScan()">üîÑ Retry Last Scan</button>
                    </div>
                </div>
            </section>

            <!-- Scan History -->
            <section class="panel history-panel">
                <div class="panel-header">
                    <h2>üìö Scan History</h2>
                    <button class="btn btn-small" onclick="refreshHistory()">üîÑ Refresh</button>
                </div>
                <div id="historyList" class="history-list">
                    <div class="empty-state">No scans yet. Start your first scan above!</div>
                </div>
            </section>

            <!-- Results Viewer -->
            <section class="panel results-panel" id="resultsPanel" style="display: none;">
                <div class="panel-header">
                    <h2>üìä Scan Results</h2>
                    <button class="btn btn-secondary btn-small" onclick="closeResults()">Close</button>
                </div>
                
                <div class="tabs">
                    <button class="tab-btn active" data-tab="summary" onclick="switchTab('summary')">Summary</button>
                    <button class="tab-btn" data-tab="files" onclick="switchTab('files')">Files</button>
                    <button class="tab-btn" data-tab="tree" onclick="switchTab('tree')">Tree View</button>
                    <button class="tab-btn" data-tab="duplicates" onclick="switchTab('duplicates')">Duplicates</button>
                    <button class="tab-btn" data-tab="security" onclick="switchTab('security')">Security</button>
                </div>

                <div class="tab-content">
                    <div id="summaryTab" class="tab-pane active">
                        <div id="summaryContent"></div>
                    </div>
                    <div id="filesTab" class="tab-pane">
                        <div id="filesContent"></div>
                    </div>
                    <div id="treeTab" class="tab-pane">
                        <div id="treeContent"></div>
                    </div>
                    <div id="duplicatesTab" class="tab-pane">
                        <div id="duplicatesContent"></div>
                    </div>
                    <div id="securityTab" class="tab-pane">
                        <div id="securityContent"></div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Directory Bundler v4.5.0 | Enhanced by AI | ¬© 2026</p>
        </footer>
    </div>

    <script src="app.js"></script>
</body>
</html>
